box: tcnksm/gox
build:
  steps:
    - setup-go-workspace
    - script:
        name: go get
        code: |
          go get -t ./...
    - script:
        name: go test
        code: |
          go test -v ./...
    - tcnksm/gox:
      os: "darwin linux windows"
      arch: "386 amd64"
    - tcnksm/zip:
      input: $WERCKER_OUTPUT_DIR/pkg
      output: $WERCKER_OUTPUT_DIR/dist
    - script:
      name: export version
      code: "structr --version | cut -d' ' -f3 > $WERCKER_OUTPUT_DIR/dist/VERISON"
deploy:
  steps:
    - script:
      name: register APP_VERSION
      code: "export APP_VERSION=$(cat $WERCKER_OUTPUT_DIR/dist/version)"
    - tcnksm/ghr:
      token: $GITHUB_TOKEN
      input: dist
      replace: true
      version: $APP_VERSION
